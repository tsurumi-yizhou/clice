<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>clice</title>
    <meta name="description" content="a powerful and modern C++ language server">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.B6tXkhGK.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DwF6IAiX.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Bcb8IYOc.js">
    <link rel="modulepreload" href="/assets/chunks/framework.U1Gow_7P.js">
    <link rel="modulepreload" href="/assets/design_design.md.C2BgqDzh.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>clice</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/markdown-examples.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Examples</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-9fd4d1dd data-v-acee064b data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-bfe7971f><span class="text" data-v-bfe7971f><span class="vpi-languages option-icon" data-v-bfe7971f></span><!----><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><div class="items" data-v-acee064b><p class="title" data-v-acee064b>English</p><!--[--><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/zh/design/design.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><div class="group translations" data-v-f953d92f><p class="trans-title" data-v-f953d92f>English</p><!--[--><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/zh/design/design.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><!--]--></div><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Examples</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/markdown-examples.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Markdown Examples</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/api-examples.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Runtime API Examples</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _design_design" data-v-e6f2a212><div><p>&quot;architectural issue&quot; here actually means the issue which can be solved but need to make a lot of modification to clangd. Currently, such big modification can be hard to push because of lack resource in clangd as mentioned <a href="https://github.com/clangd/clangd/issues/1690#issuecomment-1619735578" target="_blank" rel="noreferrer">here</a>. I am a university student, also a c++ enthusiast and a vscode user. So I have a lot of time that I can dedicate to things I am interested in.. At first, I just want to wonder whether I can make some efforts to clangd. But gradually, I found it could be better to rewrite a new LSP. After evaluating the project scale, I think it&#39;s possible to complete for just one person (about 4w~ lines and ccls is also written by one person). Then I start to dive into clangd source code and learn the clang base. So far, I have known how to build preamble, how to build AST, how to traverse AST and so on. All of them are done with clang&#39;s C++ API. Next step is putting them together into final program. However, before the actual implementation, I need to plan out its structure.</p><p>At first, how to manage message? LSP is also a type of server, and the common event-driven model is sufficient. I plan to use libuv as the event library, with the main thread handling requests and distributing tasks, while the thread pool executes the actual tasks. This is slightly different from clangd&#39;s current model; clangd doesn&#39;t use a thread pool, but rather creates a new thread for each file and uses semaphore to limit the number of active threads.</p><p>Then we need to handle TU. I decided to use a different policy with clangd, which is not to build the preamble for the file until the first edit, and headers will reuse the AST in the source file by default, also until first edit. In this way, we can reduce a lot of memory usage, speed up the loading (building preamble always needs more time compared to normal AST building) and support non self contained header. This can be very useful, people actually only need to modify a few files in big projects like LLVM. And today I found Sam also reported this <a href="https://github.com/clangd/clangd/issues/391" target="_blank" rel="noreferrer">issue</a>. Another important problem is how to interact with C++20 modules, I am still exploring this.</p><p>Next is about indexing, current indexer in clangd seems to be efficient enough, so I think I would reuse it and make only some small modifications to record more information. Also, I am wondering whether we can modify the absolute path to relative path in the index, so issue like <a href="https://github.com/clangd/clangd/issues/587" target="_blank" rel="noreferrer">support offline background index preparation</a>。It shouldn&#39;t be hard to implement.</p><p>Following is discussion on some specific LSP features:</p><h2 id="semantic-highlight" tabindex="-1">Semantic Highlight <a class="header-anchor" href="#semantic-highlight" aria-label="Permalink to &quot;Semantic Highlight&quot;">​</a></h2><p>There are several issues around it.</p><ul><li><a href="https://github.com/clangd/clangd/issues/1115" target="_blank" rel="noreferrer">provide semantic information for each token</a></li><li><a href="https://github.com/clangd/clangd/issues/358" target="_blank" rel="noreferrer">no AST node for explicit template instantiations</a></li><li><a href="https://github.com/clangd/clangd/issues/501" target="_blank" rel="noreferrer">class name does not get a coloring in constructor call </a></li><li><a href="https://github.com/clangd/clangd/issues/536" target="_blank" rel="noreferrer">store implicit specializations as distinct symbols in the index, with their own refs</a></li><li><a href="https://github.com/clangd/clangd/issues/787" target="_blank" rel="noreferrer">distinguish between type template parameter and non-type template parameter highlightings</a></li><li><a href="https://github.com/clangd/clangd/issues/872" target="_blank" rel="noreferrer">modifiers are wrong in semantic token for destructor</a></li></ul><p>Mainly about wrong or not enough information in the semantic highlight. I would like to support detail information for each token, then we can solve all of them.</p><h2 id="hint" tabindex="-1">Hint <a class="header-anchor" href="#hint" aria-label="Permalink to &quot;Hint&quot;">​</a></h2><ul><li><a href="https://github.com/clangd/clangd/issues/824" target="_blank" rel="noreferrer">simplify inlay hints</a></li><li><a href="https://github.com/clangd/clangd/issues/1357" target="_blank" rel="noreferrer">make the type hint length limit configurable</a></li><li><a href="https://github.com/clangd/clangd/issues/1535" target="_blank" rel="noreferrer">support go-to-definition on type names in inlay hints</a></li><li><a href="https://github.com/clangd/clangd/issues/542" target="_blank" rel="noreferrer">use namespace alias but not original namespace name</a></li><li><a href="https://github.com/clangd/clangd/issues/1661" target="_blank" rel="noreferrer">support folding range on directive</a></li><li><a href="https://github.com/clangd/clangd/issues/564" target="_blank" rel="noreferrer">documentation for struct member fields not working correctly</a></li><li><a href="https://github.com/clangd/clangd/issues/747" target="_blank" rel="noreferrer">make the hover box more compact</a></li><li><a href="https://github.com/clangd/clangd/issues/923" target="_blank" rel="noreferrer">padding inlay hints</a></li><li><a href="https://github.com/clangd/clangd/issues/959" target="_blank" rel="noreferrer">struct members and enum values are not shown on type hover</a></li><li><a href="https://github.com/clangd/clangd/issues/1016" target="_blank" rel="noreferrer">show length of string literal in hover</a></li><li><a href="https://github.com/clangd/clangd/issues/1163" target="_blank" rel="noreferrer">show type hints for init-captures</a></li></ul><p>Most of these problems are about hint. Providing options to allow users to configure them will be fine.</p><h2 id="action" tabindex="-1">Action <a class="header-anchor" href="#action" aria-label="Permalink to &quot;Action&quot;">​</a></h2><ul><li><a href="https://github.com/clangd/clangd/issues/445" target="_blank" rel="noreferrer">add implementation</a></li><li><a href="https://github.com/clangd/clangd/issues/466" target="_blank" rel="noreferrer">revert if</a></li><li><a href="https://github.com/clangd/clangd/issues/454" target="_blank" rel="noreferrer">move constructor argument into member</a></li><li><a href="https://github.com/clangd/clangd/issues/460" target="_blank" rel="noreferrer">modify function parameters</a></li><li><a href="https://github.com/clangd/clangd/issues/820" target="_blank" rel="noreferrer">expand macro one level</a></li></ul><p>Providing more actions will be helpful.</p><h2 id="code-completion" tabindex="-1">Code Completion <a class="header-anchor" href="#code-completion" aria-label="Permalink to &quot;Code Completion&quot;">​</a></h2><ul><li><a href="https://github.com/clangd/clangd/issues/443" target="_blank" rel="noreferrer">improve code completion inside template</a></li><li><a href="https://github.com/clangd/clangd/issues/493" target="_blank" rel="noreferrer">resolve the type of lambda auto parameters</a></li><li><a href="https://github.com/clangd/clangd/issues/678" target="_blank" rel="noreferrer">don&#39;t include template completion when inside the template class</a></li><li><a href="https://github.com/clangd/clangd/issues/727" target="_blank" rel="noreferrer">can I disable snippet</a></li><li><a href="https://github.com/clangd/clangd/issues/880" target="_blank" rel="noreferrer">no completion for definition of non-public member functions</a></li><li><a href="https://github.com/clangd/clangd/issues/753" target="_blank" rel="noreferrer">outside function definition won&#39;t complete default arguments</a></li><li><a href="https://github.com/clangd/clangd/issues/850" target="_blank" rel="noreferrer">postfix completions</a></li><li><a href="https://github.com/clangd/clangd/issues/893" target="_blank" rel="noreferrer">list free functions alongside methods in autocompletion</a></li><li><a href="https://github.com/clangd/clangd/issues/897" target="_blank" rel="noreferrer">type information lost during auto deduction in templates</a></li><li><a href="https://github.com/clangd/clangd/issues/965" target="_blank" rel="noreferrer">completion member field listing order w.r.t. C++20 designated initializers</a></li><li><a href="https://github.com/clangd/clangd/issues/968" target="_blank" rel="noreferrer">completion of pointers to functions and function objects</a></li></ul><p>These issues around code completion could be hardest to resolve. We need to modify the <code>Parser</code> and <code>SemaComplete</code> in clang to support them. Some are about templates, improving <code>HeuristicResolver</code> will resolve them.</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><!----></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/markdown-examples.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Markdown Examples</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"build.md\":\"Co74jVci\",\"configuration.md\":\"CpRedDOQ\",\"contribution.md\":\"Zb0EHW2I\",\"design_architecture.md\":\"C7gHe7F3\",\"design_clangd.md\":\"Bf0uxymm\",\"design_dependent-name.md\":\"CV61gbuX\",\"design_design.md\":\"C2BgqDzh\",\"design_index.md\":\"DRSC8Xmj\",\"design_markdown-examples.md\":\"CpB9tZ0M\",\"design_protocol.md\":\"DF8r9ZnS\",\"feature_document-symbol.md\":\"DsqxMq4k\",\"feature_folding-range.md\":\"2DTooAm1\",\"feature_inlay-hint.md\":\"D7ZN-35G\",\"feature_semantic-tokens.md\":\"B5B0Hwzv\",\"index.md\":\"BEJniuFs\",\"zh_index.md\":\"C4JCmGa6\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"clice\",\"description\":\"a powerful and modern C++ language server\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{\"root\":{\"label\":\"English\"},\"zh\":{\"label\":\"简体中文\"}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>